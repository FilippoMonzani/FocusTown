// --------------------------------------------------------
// Code generated by Papyrus Java
// --------------------------------------------------------

package main;

import java.awt.EventQueue;

import javax.swing.JButton;

import org.hibernate.Session;
import org.hibernate.SessionFactory;

import view.AppView;
import view.LoginView;
import view.RegView;
import view.View;

/************************************************************/
/**
 * 
 */
public class FocusApp {
	/**
				 * 
				 */
	public User[] user;
	/**
				 * 
				 */
	public City[] city;

	private static LoginView loginView = null;
	private static RegView regView = null;

	public static void main(String[] args) {
		EventQueue.invokeLater(new Runnable() {
			public void run() {
				try {
					loginView = new LoginView();
					loginView.setVisible(true);
					regView = new RegView();
					
					setBtnDestination(loginView.getBtnReg(), loginView, regView);
					setBtnDestination(regView.getBackToLoginBtn(), regView, loginView); // Forse vale la pena di creare una classe wrapper per ogni view?
					
					regView.getBtnReg().addActionListener(a -> {
						addUser();
						regView.showSuccessDialog();
						regView.setVisible(false);
						loginView.setVisible(true);
					});
					
					System.out.println("Listeners added");
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		});
	}

	/***
	 * Imposta la view di destinazione a cui porta un bottone
	 * @param btn Bottone che porta alla view 'dest'
	 * @param source View che ospita il bottone
	 * @param dest View a cui deve portare il bottone
	 */
	private static void setBtnDestination(JButton btn, View source, View dest) {
		btn.addActionListener(a -> {
			source.setVisible(false);
			dest.setVisible(true);
		});
	}
	
	private static void changeToRegView() {
		try {
			regView.setVisible(true);
			loginView.setVisible(false);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	/**
	 * 
	 * @param duration
	 * @return
	 * @return
	 */
	public void startTimer(int duration) {
	}

	/**
	 * 
	 */
	public void endTimer() {
	}

	private static void addUser() {
		User user = new User(regView.getUsername(), regView.getPassword());
		if (user.read() != null) {
			throw new DuplicateUserException();
		} else {
			user.save();
		}
		
//			User user = new User(regView.getUsername(), regView.getPassword());
//			session = HibernateUtil.getSessionFactory().openSession();
//			session.beginTransaction();
//			User u = session.find(User.class, user.getUsername());
//			if (u != null) {
//				throw new DuplicateUserException();
//			} else {
//				session.persist(user);
//			}
//			session.getTransaction().commit();
//			if (session != null) {
//				session.close();
		
	}
}
